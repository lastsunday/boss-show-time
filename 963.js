(()=>{"use strict";var e,o,t={963:(e,o,t)=>{const a=0,s=1,r=2,n=r;function i(e){n<=r&&console.log(e)}function b(e){n==a?console.trace(e):n==s&&console.warn(e)}var _=t(2556),m=t(4353),l=t.n(m);new Map;class j{jobId;jobPlatform;jobUrl;jobName;jobCompanyName;jobLocationName;jobAddress;jobLongitude;jobLatitude;jobDescription;jobDegreeName;jobYear;jobSalaryMin;jobSalaryMax;jobSalaryTotalMonth;jobFirstPublishDatetime;bossName;bossCompanyName;bossPosition;createDatetime;updateDatetime}class c extends j{browseCount}class d{getSqlList(){return[]}}class u extends d{getSqlList(){return["\n  CREATE TABLE job(\n    job_id TEXT PRIMARY KEY,\n    job_platform TEXT,\n    job_url TEXT, \n    job_name TEXT,\n    job_company_name TEXT,\n    job_location_name TEXT,\n    job_address TEXT,\n    job_longitude NUMERIC,\n    job_latitude NUMERIC,\n    job_description TEXT,\n    job_degree_name TEXT,\n    job_year TEXT,\n    job_salary_min TEXT,\n    job_salary_max TEXT,\n    job_salary_total_month TEXT,\n    job_first_publish_datetime DATETIME,\n    boss_name TEXT,\n    boss_company_name  TEXT,\n    boss_position TEXT,\n    create_datetime DATETIME,\n    update_datetime DATETIME\n  )\n  ","\n  CREATE TABLE job_browse_history(\n    job_id TEXT,\n    job_visit_datetime DATETIME,\n    job_visit_type TEXT\n  )\n  "]}}var p,f=[];class y{todayBrowseCount;totalBrowseCount;totalJob}class h{items;total}class T extends h{}b("worker ready");var g=!1;const E={init:function(e,o){b("Loading and initializing sqlite3 module...");let t=[];t.push(new u),function(e){f=e}(t),(0,_.A)({print:b,printErr:i}).then((function(o){if(b("Done initializing. Running app..."),g)N(e);else try{M(o),g=!0,N(e)}catch(o){O(e,"init sqlite3 error : "+o.message)}}))},ping:function(e,o){N(e,"pong")},batchAddOrUpdateJobBrowse:function(e,o){try{const t=new Date;p.exec({sql:"BEGIN TRANSACTION"});for(let e=0;e<o.length;e++)A(o[e],t);p.exec({sql:"COMMIT"}),N(e,{})}catch(o){O(e,"[worker] addOrUpdateJobBrowse error : "+o.message)}},addOrUpdateJobBrowse:function(e,o){try{const t=new Date;p.exec({sql:"BEGIN TRANSACTION"}),A(o,t),p.exec({sql:"COMMIT"}),N(e,{})}catch(o){O(e,"[worker] addOrUpdateJobBrowse error : "+o.message)}},getJobBrowseInfoByIds:function(e,o){try{var t=new Map,a="'"+o.join("','")+"'";const d="SELECT job_id AS jobId ,count(*) AS total FROM job_browse_history WHERE job_id IN ("+a+") GROUP BY job_id;";var s=[];p.exec({sql:d,rowMode:"object",resultRows:s});for(let e=0;e<s.length;e++){let o=s[e];t.set(o.jobId,o.total)}var r=new Map;const u="SELECT job_id,job_platform,job_url,job_name,job_company_name,job_location_name,job_address,job_longitude,job_latitude,job_description,job_degree_name,job_year,job_salary_min,job_salary_max,job_salary_total_month,boss_name,boss_company_name,boss_position,create_datetime,update_datetime FROM job WHERE job_id in ("+a+")";var n=[];p.exec({sql:u,rowMode:"object",resultRows:n});for(var i=0;i<n.length;i++){var b=n[i],_=new c,m=Object.keys(b);for(let e=0;e<m.length;e++){var l=m[e];_[(j=l,j.replace(/\_(\w)/g,(function(e,o){return o.toUpperCase()})))]=b[l]}r.set(_.jobId,_)}let f=[];for(let e=0;e<o.length;e++){let a=o[e],s=r.get(a);s&&(s.browseCount=t.get(a)),f.push(s)}N(e,f)}catch(o){O(e,"[worker] getJobBrowseInfoByIds error : "+o.message)}var j},searchJob:function(e,o){try{let n=new T,i="SELECT job_id AS jobId,job_platform AS jobPlatform,job_url AS jobUrl,job_name AS jobName,job_company_name AS jobCompanyName,job_location_name AS jobLocationName,job_address AS jobAddress,job_longitude AS jobLongitude,job_latitude AS jobLatitude,job_description AS jobDescription,job_degree_name AS jobDegreeName,job_year AS jobYear,job_salary_min AS jobSalaryMin,job_salary_max AS jobSalaryMax,job_salary_total_month AS jobSalaryTotalMonth,job_first_publish_datetime AS jobFirstPublishDatetime,boss_name AS bossName,boss_company_name AS bossCompanyName,boss_position AS bossPosition,create_datetime AS createDatetime,update_datetime AS updateDatetime FROM job",b="SELECT COUNT(*) AS total from job",_="",m=" ORDER BY create_datetime DESC",j=" limit "+(o.pageNum-1)*o.pageSize+","+o.pageSize;o.jobName&&(_+=" AND job_name LIKE '%"+o.jobName+"%' "),o.jobCompanyName&&(_+=" AND job_company_name LIKE '%"+o.jobCompanyName+"%' "),o.startDatetime&&(_+=" AND create_datetime >= '"+l()(o.startDatetime).format("YYYY-MM-DD HH:mm:ss")+"'"),o.endDatetime&&(_+=" AND create_datetime < '"+l()(o.endDatetime).format("YYYY-MM-DD HH:mm:ss")+"'"),o.firstPublishStartDatetime&&(_+=" AND job_first_publish_datetime >= '"+l()(o.firstPublishStartDatetime).format("YYYY-MM-DD HH:mm:ss")+"'"),o.firstPublishEndDatetime&&(_+=" AND job_first_publish_datetime < '"+l()(o.firstPublishEndDatetime).format("YYYY-MM-DD HH:mm:ss")+"'"),_.startsWith(" AND")&&(_=_.replace("AND",""),_=" WHERE "+_),i+=_,i+=m,i+=j;let d=[],u=0,f=[];p.exec({sql:i,rowMode:"object",resultRows:f});for(var t=0;t<f.length;t++){let e=f[t],o=new c;var a=Object.keys(e);for(let t=0;t<a.length;t++){var s=a[t];o[s]=e[s]}d.push(e)}b+=_;var r=[];p.exec({sql:b,rowMode:"object",resultRows:r}),u=r[0].total,n.items=d,n.total=u,N(e,n)}catch(o){O(e,"[worker] searchJob error : "+o.message)}},statisticJobBrowse:function(e,o){try{let o=new y,r=l()(),n=r.startOf("day").format("YYYY-MM-DD HH:mm:ss"),i=r.startOf("day").add(1,"day").format("YYYY-MM-DD HH:mm:ss");const b="SELECT COUNT(*) AS count FROM job_browse_history WHERE job_visit_datetime >= $startDatetime AND job_visit_datetime < $endDatetime";var t=[];p.exec({sql:b,rowMode:"object",resultRows:t,bind:{$startDatetime:n,$endDatetime:i}});const _="SELECT COUNT(*) AS count FROM job_browse_history";var a=[];p.exec({sql:_,rowMode:"object",resultRows:a});const m="SELECT COUNT(*) AS count FROM job;";var s=[];p.exec({sql:m,rowMode:"object",resultRows:s}),o.todayBrowseCount=t[0].count,o.totalBrowseCount=a[0].count,o.totalJob=s[0].count,N(e,o)}catch(o){O(e,"[worker] statisticJobBrowse error : "+o.message)}}},D=new Map;for(var S=Object.keys(E),w=0;w<S.length;w++){var v=S[w];D.set(v,E[v])}function A(e,o){let t=[];if(p.exec({sql:"SELECT job_id,job_platform,job_url,job_name,job_company_name,job_location_name,job_address,job_longitude,job_latitude,job_description,job_degree_name,job_year,job_salary_min,job_salary_max,job_salary_total_month,job_first_publish_datetime,boss_name,boss_company_name,boss_position,create_datetime,update_datetime FROM job WHERE job_id = ?",rowMode:"object",bind:[e.jobId],resultRows:t}),t.length>0);else{const t="\n  INSERT INTO job (job_id,job_platform,job_url,job_name,job_company_name,job_location_name,job_address,job_longitude,job_latitude,job_description,job_degree_name,job_year,job_salary_min,job_salary_max,job_salary_total_month,job_first_publish_datetime,boss_name,boss_company_name,boss_position,create_datetime,update_datetime) VALUES ($job_id,$job_platform,$job_url,$job_name,$job_company_name,$job_location_name,$job_address,$job_longitude,$job_latitude,$job_description,$job_degree_name,$job_year,$job_salary_min,$job_salary_max,$job_salary_total_month,$job_first_publish_datetime,$boss_name,$boss_company_name,$boss_position,$create_datetime,$update_datetime)\n";p.exec({sql:t,bind:{$job_id:e.jobId,$job_platform:e.jobPlatform,$job_url:e.jobUrl,$job_name:e.jobName,$job_company_name:e.jobCompanyName,$job_location_name:e.jobLocationName,$job_address:e.jobAddress,$job_longitude:e.jobLongitude,$job_latitude:e.jobLatitude,$job_description:e.jobDescription,$job_degree_name:e.jobDegreeName,$job_year:e.jobYear,$job_salary_min:e.jobSalaryMin,$job_salary_max:e.jobSalaryMax,$job_salary_total_month:e.jobSalaryTotal,$job_first_publish_datetime:l()(e.jobFirstPublishDatetime).isValid()?l()(e.jobFirstPublishDatetime).format("YYYY-MM-DD HH:mm:ss"):null,$boss_name:e.bossName,$boss_company_name:e.bossCompanyName,$boss_position:e.bossPosition,$create_datetime:l()(o).format("YYYY-MM-DD HH:mm:ss"),$update_datetime:l()(o).format("YYYY-MM-DD HH:mm:ss")}})}p.exec({sql:"\nINSERT INTO job_browse_history (job_id,job_visit_datetime,job_visit_type) VALUES ($job_id,$job_visit_datetime,$job_visit_type)\n",bind:{$job_id:e.jobId,$job_visit_datetime:l()(o).format("YYYY-MM-DD HH:mm:ss"),$job_visit_type:"SEARCH"}})}const M=function(e){const o=e.capi,t=e.oo1;b("SQLite3 version",o.sqlite3_libversion(),o.sqlite3_sourceid()),"OpfsDb"in t?(p=new t.OpfsDb("/job.sqlite3"),b("[DB] The OPFS is available."),b("[DB] Persisted db =",p.filename)):(p=new t.DB("/job.sqlite3","ct"),b("[DB] The OPFS is not available."),b("[DB] transient db =",p.filename)),i("[DB] schema checking...");let a=f,s=0,r=a.length;try{const e="SELECT COUNT(*) AS count FROM sqlite_schema;";let o=0,t=[];if(p.exec({sql:e,rowMode:"object",resultRows:t}),t.length>0&&(o=t[0].count),i("[DB] current schemaCount = "+o),0==o){const e="PRAGMA auto_vacuum = 1";p.exec(e),i("[DB] execute "+e)}}catch(e){return void console.error("[DB] checking schema fail,"+e.message)}try{p.exec({sql:"BEGIN TRANSACTION"});const e="\n    CREATE TABLE IF NOT EXISTS version(\n      num INTEGER\n    )\n  ";p.exec(e);const o="SELECT num FROM version";var n=[];if(p.exec({sql:o,rowMode:"object",resultRows:n}),n.length>0)s=n[0].num;else{const e="INSERT INTO version(num) values($num)";p.exec({sql:e,bind:{$num:0}})}if(i("[DB] schema oldVersion = "+s+", newVersion = "+r),r>s){i("[DB] schema upgrade start");for(let e=s;e<r;e++){let o=e+1,t=a[e].getSqlList();i("[DB] schema upgrade changelog version = "+o+", sql total = "+t.length);for(let e=0;e<t.length;e++){i("[DB] schema upgrade changelog version = "+o+", execute sql = "+(e+1)+"/"+t.length);let a=t[e];p.exec(a)}}const e="UPDATE version SET num = $num";p.exec({sql:e,bind:{$num:r}}),i("[DB] schema upgrade finish to version = "+r),i("[DB] current schema version = "+r)}else i("[DB] skip schema upgrade"),i("[DB] current schema version = "+s);p.exec({sql:"COMMIT"})}catch(e){console.error("[DB] schema upgrade fail,"+e.message),p.exec({sql:"ROLLBACK TRANSACTION"})}};function N(e,o){var t=JSON.parse(JSON.stringify(e));t.data=o,postMessage({type:"db",data:t}),b("[worker][send][worker -> offscreen] message = "+JSON.stringify(t))}function O(e,o){i(o);var t=JSON.parse(JSON.stringify(e));b(t),t.error=o,postMessage({type:"db",data:t}),b("[worker][send][worker -> offscreen] message = "+JSON.stringify(t))}onmessage=function(e){var o=e.data;b("[worker][receive][offscreen -> worker] message = "+JSON.stringify(o));var t=o.action;b("[worker] invoke action = "+t),D.get(t)(o,o.param)}}},a={};function s(e){var o=a[e];if(void 0!==o)return o.exports;var r=a[e]={exports:{}};return t[e].call(r.exports,r,r.exports,s),r.exports}s.m=t,s.x=()=>{var e=s.O(void 0,[372],(()=>s(963)));return s.O(e)},e=[],s.O=(o,t,a,r)=>{if(!t){var n=1/0;for(m=0;m<e.length;m++){for(var[t,a,r]=e[m],i=!0,b=0;b<t.length;b++)(!1&r||n>=r)&&Object.keys(s.O).every((e=>s.O[e](t[b])))?t.splice(b--,1):(i=!1,r<n&&(n=r));if(i){e.splice(m--,1);var _=a();void 0!==_&&(o=_)}}return o}r=r||0;for(var m=e.length;m>0&&e[m-1][2]>r;m--)e[m]=e[m-1];e[m]=[t,a,r]},s.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return s.d(o,{a:o}),o},s.d=(e,o)=>{for(var t in o)s.o(o,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:o[t]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((o,t)=>(s.f[t](e,o),o)),[])),s.u=e=>e+".js",s.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),s.p="./",(()=>{s.b=self.location+"";var e={963:1};s.f.i=(o,t)=>{e[o]||importScripts(s.p+s.u(o))};var o=self.webpackChunkboss_show_time=self.webpackChunkboss_show_time||[],t=o.push.bind(o);o.push=o=>{var[a,r,n]=o;for(var i in r)s.o(r,i)&&(s.m[i]=r[i]);for(n&&n(s);a.length;)e[a.pop()]=1;t(o)}})(),o=s.x,s.x=()=>s.e(372).then(o),s.x()})();
//# sourceMappingURL=963.js.map